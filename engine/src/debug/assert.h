/*
    @file assert.h
    @brief Система утверждений для отладочной проверки условий.
    @author Дмитрий Скляр.
    @version 1.0
    @date 27-08-2025

    @license Лицензия Apache, версия 2.0 («Лицензия»);
          Вы не имеете права использовать этот файл без соблюдения условий Лицензии.
          Копию Лицензии можно получить по адресу http://www.apache.org/licenses/LICENSE-2.0
          Если иное не предусмотрено действующим законодательством или не согласовано в письменной форме,
          программное обеспечение, распространяемое по Лицензии, распространяется на условиях «КАК ЕСТЬ»,
          БЕЗ КАКИХ-ЛИБО ГАРАНТИЙ ИЛИ УСЛОВИЙ, явных или подразумеваемых. См. Лицензию для получения
          информации о конкретных языках, регулирующих разрешения и ограничения по Лицензии.

    @note Предоставляет:
            - Макрос ASSERT для проверки условий в отладочной сборке
            - Автоматическое отключение проверок в релизной сборке
            - Детализированные сообщения об ошибках с указанием файла и строки
            - Остановку выполнения в отладчике при срабатывании утверждения
            - Безопасную конструкцию do-while для избежания проблем с операторами
*/

#pragma once

#include <core/defines.h>
#include <core/logger.h>

#if DEBUG_FLAG
    /*
        @brief Проверка утверждения с остановкой программы при ошибке в отладочной сборке.
        @note Если выражение ложно: выводит фатальную ошибку с текстом условия, сообщением, файлом и строкой
              и останавливает выполнение в отладчике (если он подключен) или аварийно завершает программу.
        @param expr Проверяемое выражение (должно быть true в нормальной ситуации).
        @param message Сообщение об ошибке для вывода в лог.
    */
    #define ASSERT(expr, message)                                                    \
    do {                                                                             \
        if(!(expr))                                                                  \
        {                                                                            \
            LOG_FATAL("Assertion failed: '%s' with message: '%s'.", #expr, message); \
            DEBUG_BREAK();                                                           \
        }                                                                            \
    } while(false)
#else
    /*
        @brief Проверка утверждения с остановкой программы при ошибке в отладочной сборке.
        @note Если выражение ложно: выводит фатальную ошибку с текстом условия, сообщением, файлом и строкой
              и останавливает выполнение в отладчике (если он подключен) или аварийно завершает программу.
        @param expr Проверяемое выражение (должно быть true в нормальной ситуации).
        @param message Сообщение об ошибке для вывода в лог.
    */
    #define ASSERT(expr, message) ((void)0)
#endif
