/*
    @file xcb_backend.h
    @brief XCB бэкенд для системы управления окнами на платформе Linux.
    @author Дмитрий Скляр.
    @version 1.0
    @date 27-08-2025

    @license Лицензия Apache, версия 2.0 («Лицензия»);
          Вы не имеете права использовать этот файл без соблюдения условий Лицензии.
          Копию Лицензии можно получить по адресу http://www.apache.org/licenses/LICENSE-2.0
          Если иное не предусмотрено действующим законодательством или не согласовано в письменной форме,
          программное обеспечение, распространяемое по Лицензии, распространяется на условиях «КАК ЕСТЬ»,
          БЕЗ КАКИХ-ЛИБО ГАРАНТИЙ ИЛИ УСЛОВИЙ, явных или подразумеваемых. См. Лицензию для получения
          информации о конкретных языках, регулирующих разрешения и ограничения по Лицензии.

    @note Предоставляет:
            - Инициализацию и завершение работы XCB бэкенда
            - Обработку событий оконной системы через XCB
            - Создание и уничтожение окон через XCB протокол
            - Проверку поддержки XCB на целевой системе
            - Управление требованиями к памяти для XCB контекста

    @dependencies Требует XCB библиотеки для работы с X Window System
*/

#pragma once

#include <core/defines.h>
#include <platform/window.h>

/*
    @brief Инициализирует XCB бэкенд для работы с оконной системой.
    @note Должна быть вызвана перед использованием других функций бэкенда.
    @param internal_data Указатель на внутренние данные бэкенда.
    @return true если инициализация прошла успешно, false в случае ошибки.
*/
bool xcb_backend_initialize(void* internal_data);

/*
    @brief Завершает работу XCB бэкенда и освобождает ресурсы.
    @note Должна быть вызвана после завершения работы с бэкендом.
    @param internal_data Указатель на внутренние данные бэкенда.
*/
void xcb_backend_shutdown(void* internal_data);

/*
    @brief Обрабатывает события оконной системы через XCB.
    @note Должна вызываться каждый кадр для обработки входящих событий.
    @param internal_data Указатель на внутренние данные бэкенда.
    @return true если обработка событий прошла успешно, false в случае ошибки.
*/
bool xcb_backend_poll_events(void* internal_data);

/*
    @brief Проверяет поддержку XCB на текущей системе.
    @note Может использоваться для выбора подходящего бэкенда во время выполнения.
    @return true если XCB поддерживается, false в противном случае.
*/
bool xcb_backend_is_supported();

/*
    @brief Возвращает требования к памяти для XCB бэкенда.
    @note Используется для выделения достаточного объема памяти перед инициализацией.
    @return Количество байт памяти, необходимое для работы бэкенда.
*/
u64  xcb_backend_memory_requirement();

/*
    @brief Создает новое окно через XCB бэкенд.
    @note Окно создается с параметрами, указанными в конфигурации.
    @param config Конфигурация создаваемого окна.
    @param internal_data Указатель на внутренние данные бэкенда.
    @return Указатель на созданное окно или nullptr в случае ошибки.
*/
platform_window* xcb_backend_window_create(const platform_window_config* config, void* internal_data);

/*
    @brief Уничтожает окно, созданное через XCB бэкенд.
    @note Освобождает все ресурсы, связанные с окном.
    @param window Указатель на уничтожаемое окно.
    @param internal_data Указатель на внутренние данные бэкенда.
*/
void xcb_backend_window_destroy(platform_window* window, void* internal_data);
