/*
    @file time.h
    @brief Кросс-платформенный интерфейс для работы со временем и таймерами.
    @author Дмитрий Скляр.
    @version 1.1
    @date 28-01-2026

    @license Лицензия Apache, версия 2.0 («Лицензия»);
          Вы не имеете права использовать этот файл без соблюдения условий Лицензии.
          Копию Лицензии можно получить по адресу http://www.apache.org/licenses/LICENSE-2.0
          Если иное не предусмотрено действующим законодательством или не согласовано в письменной форме,
          программное обеспечение, распространяемое по Лицензии, распространяется на условиях «КАК ЕСТЬ»,
          БЕЗ КАКИХ-ЛИБО ГАРАНТИЙ ИЛИ УСЛОВИЙ, явных или подразумеваемых. См. Лицензию для получения
          информации о конкретных языках, регулирующих разрешения и ограничения по Лицензии.

    @note Реализации функций являются платформозависимыми и находятся в соответствующих
          platform/ модулях (windows, linux и т.д.).

    @note Для корректной работы необходимо предварительно инициализировать (в указанном порядке):
            - Подсистему консоли platform_console_initialize()
            - Подсистему таймера platform_time_initialize()
*/

#pragma once

#include <core/defines.h>

// @brief Структура для представления даты и времени.
typedef struct platform_datetime {
    // @brief Год (диапазон: 1970 - 2100).
    u16 year;
    // @brief Месяц (диапазон: 1-12).
    u8 month;
    // @brief День месяца (диапазон: 1-31).
    u8 day;
    // @brief Часы (диапазон: 0-23).
    u8 hour;
    // @brief Минуты (диапазон: 0-59).
    u8 minute;
    // @brief Секунды (диапазон: 0-59).
    u8 second;
} platform_datetime;

/*
    @brief Инициализирует подсистему для работы со временем и таймерами.
    @warning Не thread-safe. Должна вызываться из основного потока.
    @note Должна быть вызвана один раз при старте приложения.
    @return true - инициализация успешна, false - произошла ошибка.
*/
bool platform_time_initialize(void);

/*
    @brief Завершает работу подсистемы для работы со временем и таймерами.
    @warning Не thread-safe. Должна вызываться из основного потока.
    @note Должна быть вызвана при завершении приложения.
*/
void platform_time_shutdown(void);

/*
    @brief Проверяет, была ли инициализирована подсистема для работы со временем и таймерами.
    @note Может использоваться для проверки состояния подсистемы перед вызовом других функций.
    @return true - подсистема инициализирована успешно, false - подсистема не инициализирована.
*/
API bool platform_time_is_initialized(void);

/*
    @brief Получает текущее время в секундах с эпохи Unix (1970-01-01 00:00:00 UTC).
    @note Thread-safe и может использоваться без дополнительной синхронизации.
    @return Количество секунд, прошедших с 1970-01-01 00:00:00 UTC.
*/
API u64 platform_time_now(void);

/*
    @brief Получает seed на основе текущего значение системного таймера высокой точности.
    @note Thread-safe, не подходит для криптографических целей.
    @return Начальное значение для генераторов случайных чисел.
*/
API u64 platform_time_seed(void);

/*
    @brief Получает время работы системы (uptime) в секундах с высокой точностью.
    @note Thread-safe, идеально для измерения интервалов, таймингов, игрового цикла.
    @return Количество секунд с момента загрузки системы с высокой точностью.
*/
API f64 platform_time_uptime(void);

/*
    @brief Преобразует время в секундах в локальное дату и время.
    @warning Не thread-safe на некоторых платформах из-за использования системных функций локали.
    @param time_sec Количество секунд с 1970-01-01 00:00:00 UTC.
    @return Структура platform_datetime с локальным временем.
*/
API platform_datetime platform_time_to_local(u64 time_sec);

/*
    @brief Преобразует время в секундах в дату и время UTC.
    @warning Не thread-safe на некоторых платформах.
    @param time_sec Количество секунд с 1970-01-01 00:00:00 UTC.
    @return Структура platform_datetime с временем UTC.
*/
API platform_datetime platform_time_to_utc(u64 time_sec);

/*
    @brief Преобразует структуру даты и времени в секунды с эпохи Unix.
    @note Thread-safe и может использоваться без дополнительной синхронизации.
    @note Не корректирует недопустимые значения даты - возвращает 0 при ошибке.
    @param dt Указатель на структуру platform_datetime для сохранения результата преобразования.
    @return Количество секунд с 1970-01-01 00:00:00 UTC или 0 при недопустимой дате.
*/
API u64 platform_time_from_datetime(const platform_datetime* dt);
